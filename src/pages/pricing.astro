---
import LandingLayout from '../layouts/LandingLayout.astro';

const title = 'AgencyOS Pricing - Simple Plans, Massive Value';
const description = 'All plans include 85+ AI commands. Pick what fits your agency. 7-day free trial.';
---

<LandingLayout title={title} description={description}>

<!-- Hero -->
<div class="text-center py-12">
  <h1 class="text-4xl font-bold mb-4 text-[var(--color-text-primary)]">
    Simple pricing. Massive value.
  </h1>
  <p class="text-lg text-[var(--color-text-muted)]">
    All plans include 85+ AI commands. Pick what fits your agency.
  </p>
</div>

<!-- Promo Code Input -->
<section class="py-4 mb-8">
  <div class="max-w-md mx-auto">
    <div id="promo-box" class="p-4 rounded-xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)]">
      <label class="block text-sm font-medium mb-2 text-[var(--color-text-primary)]">
        üéüÔ∏è Have a promo code?
      </label>
      <div class="flex gap-2">
        <input 
          type="text" 
          id="promo-input" 
          placeholder="Enter code (e.g. AGENCYOS-XXXX)"
          class="flex-1 px-4 py-2 rounded-lg bg-[var(--color-bg-tertiary)] border border-[var(--color-border)] text-[var(--color-text-primary)] placeholder:text-[var(--color-text-muted)] focus:outline-none focus:border-[var(--color-accent-green)]"
        />
        <button 
          id="apply-promo-btn"
          class="px-6 py-2 bg-[var(--color-accent-green)] text-white rounded-lg font-medium hover:brightness-110 transition-all"
        >
          Apply
        </button>
      </div>
      <div id="promo-result" class="mt-3 hidden">
        <div class="flex items-center gap-2 text-sm">
          <span class="text-green-500">‚úì</span>
          <span id="promo-message" class="text-green-500"></span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Pricing Cards -->
<section id="pricing-plans" class="py-8">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
    
    <!-- Starter -->
    <div class="p-8 rounded-2xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)] hover:border-[var(--color-accent-green)] transition-all">
      <h3 class="text-xl font-semibold mb-2 text-[var(--color-text-primary)]">Starter</h3>
      <div class="text-4xl font-bold mb-2 text-[var(--color-text-primary)]">
        $29<span class="text-lg font-normal text-[var(--color-text-muted)]">/month</span>
      </div>
      <p class="text-sm text-[var(--color-text-muted)] mb-6">Perfect for solo operators</p>
      
      <a href="/docs/getting-started/installation" class="block w-full py-3 text-center bg-[var(--color-bg-tertiary)] border border-[var(--color-border)] rounded-lg font-medium text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)] transition-all mb-6">
        Start Free Trial
      </a>
      
      <ul class="space-y-3 text-sm">
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> 85+ AI commands
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Marketing automation
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Sales proposals
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Affiliate tracking
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Finance dashboard
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Community support
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Monthly updates
        </li>
      </ul>
    </div>

    <!-- Pro -->
    <div class="p-8 rounded-2xl bg-[var(--color-bg-secondary)] border-2 border-[var(--color-accent-green)] relative transform scale-105 shadow-xl">
      <div class="absolute -top-4 left-1/2 -translate-x-1/2 px-4 py-1 bg-[var(--color-accent-green)] text-white text-sm font-semibold rounded-full">
        MOST POPULAR
      </div>
      <h3 class="text-xl font-semibold mb-2 text-[var(--color-text-primary)]">Pro</h3>
      <div class="text-4xl font-bold mb-2 text-[var(--color-text-primary)]">
        $99<span class="text-lg font-normal text-[var(--color-text-muted)]">/month</span>
      </div>
      <p class="text-sm text-[var(--color-text-muted)] mb-6">For serious agency builders</p>
      
      <a href="/docs/getting-started/installation" class="block w-full py-3 text-center bg-[var(--color-accent-green)] text-white rounded-lg font-medium hover:brightness-110 transition-all mb-6">
        Start Free Trial
      </a>
      
      <ul class="space-y-3 text-sm">
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Everything in Starter
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Priority support (24h)
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> 5 team seats
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Advanced analytics
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Custom branding
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> API access
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> 1-on-1 onboarding call
        </li>
      </ul>
    </div>

    <!-- Franchise -->
    <div class="p-8 rounded-2xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)] hover:border-[var(--color-accent-purple)] transition-all">
      <h3 class="text-xl font-semibold mb-2 text-[var(--color-text-primary)]">Franchise</h3>
      <div class="text-4xl font-bold mb-2 text-[var(--color-text-primary)]">
        $299<span class="text-lg font-normal text-[var(--color-text-muted)]">/month</span>
      </div>
      <p class="text-sm text-[var(--color-text-muted)] mb-6">White-label & resell</p>
      
      <a href="mailto:franchise@agencyos.network" class="block w-full py-3 text-center bg-[var(--color-bg-tertiary)] border border-[var(--color-border)] rounded-lg font-medium text-[var(--color-text-primary)] hover:bg-[var(--color-bg-secondary)] transition-all mb-6">
        Contact Sales
      </a>
      
      <ul class="space-y-3 text-sm">
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Everything in Pro
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> White-label rights
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Custom domain
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Unlimited seats
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Revenue share (85%)
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Franchise support
        </li>
        <li class="flex items-center gap-2 text-[var(--color-text-secondary)]">
          <span class="text-green-500">‚úì</span> Quarterly strategy calls
        </li>
      </ul>
    </div>
  </div>
</section>

<!-- Annual Savings -->
<section class="py-8 text-center">
  <div class="inline-block p-6 rounded-xl bg-[var(--color-bg-tertiary)] border border-[var(--color-border)]">
    <p class="text-lg font-semibold text-[var(--color-text-primary)] mb-2">üí∞ Save 20% with annual billing</p>
    <div class="flex gap-8 justify-center text-sm text-[var(--color-text-muted)]">
      <span>Starter: $279/year</span>
      <span>Pro: $949/year</span>
      <span>Franchise: $2,869/year</span>
    </div>
  </div>
</section>

<!-- Feature Comparison -->
<section id="compare-features" class="py-12">
  <h2 class="text-2xl font-bold text-center mb-8 text-[var(--color-text-primary)]">Compare Features</h2>
  
  <div class="overflow-x-auto">
    <table class="w-full max-w-4xl mx-auto text-sm">
      <thead>
        <tr class="border-b border-[var(--color-border)]">
          <th class="py-4 px-4 text-left text-[var(--color-text-primary)]">Feature</th>
          <th class="py-4 px-4 text-center text-[var(--color-text-primary)]">Starter</th>
          <th class="py-4 px-4 text-center text-[var(--color-text-primary)]">Pro</th>
          <th class="py-4 px-4 text-center text-[var(--color-text-primary)]">Franchise</th>
        </tr>
      </thead>
      <tbody class="text-[var(--color-text-secondary)]">
        <tr class="border-b border-[var(--color-border)]">
          <td class="py-3 px-4">AI Commands</td>
          <td class="py-3 px-4 text-center">85+</td>
          <td class="py-3 px-4 text-center">85+</td>
          <td class="py-3 px-4 text-center">85+</td>
        </tr>
        <tr class="border-b border-[var(--color-border)]">
          <td class="py-3 px-4">Team Seats</td>
          <td class="py-3 px-4 text-center">1</td>
          <td class="py-3 px-4 text-center">5</td>
          <td class="py-3 px-4 text-center">Unlimited</td>
        </tr>
        <tr class="border-b border-[var(--color-border)]">
          <td class="py-3 px-4">Support</td>
          <td class="py-3 px-4 text-center">Community</td>
          <td class="py-3 px-4 text-center">Priority (24h)</td>
          <td class="py-3 px-4 text-center">Dedicated</td>
        </tr>
        <tr class="border-b border-[var(--color-border)]">
          <td class="py-3 px-4">Custom Branding</td>
          <td class="py-3 px-4 text-center">‚ùå</td>
          <td class="py-3 px-4 text-center">‚úÖ</td>
          <td class="py-3 px-4 text-center">‚úÖ</td>
        </tr>
        <tr class="border-b border-[var(--color-border)]">
          <td class="py-3 px-4">White-label</td>
          <td class="py-3 px-4 text-center">‚ùå</td>
          <td class="py-3 px-4 text-center">‚ùå</td>
          <td class="py-3 px-4 text-center">‚úÖ</td>
        </tr>
        <tr class="border-b border-[var(--color-border)]">
          <td class="py-3 px-4">API Access</td>
          <td class="py-3 px-4 text-center">‚ùå</td>
          <td class="py-3 px-4 text-center">‚úÖ</td>
          <td class="py-3 px-4 text-center">‚úÖ</td>
        </tr>
        <tr class="border-b border-[var(--color-border)]">
          <td class="py-3 px-4">Onboarding</td>
          <td class="py-3 px-4 text-center">Docs</td>
          <td class="py-3 px-4 text-center">1-on-1 call</td>
          <td class="py-3 px-4 text-center">Full setup</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- FAQ -->
<section id="faq" class="py-12">
  <h2 class="text-2xl font-bold text-center mb-8 text-[var(--color-text-primary)]">Frequently Asked Questions</h2>
  
  <div class="max-w-2xl mx-auto space-y-6">
    <div class="p-6 rounded-xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)]">
      <h3 class="font-semibold mb-2 text-[var(--color-text-primary)]">Can I switch plans?</h3>
      <p class="text-sm text-[var(--color-text-muted)]">Yes! Upgrade or downgrade anytime. Changes take effect on your next billing cycle.</p>
    </div>
    
    <div class="p-6 rounded-xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)]">
      <h3 class="font-semibold mb-2 text-[var(--color-text-primary)]">Is there a free trial?</h3>
      <p class="text-sm text-[var(--color-text-muted)]">Yes! 7-day free trial on all plans. No credit card required to start.</p>
    </div>
    
    <div class="p-6 rounded-xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)]">
      <h3 class="font-semibold mb-2 text-[var(--color-text-primary)]">What payment methods do you accept?</h3>
      <p class="text-sm text-[var(--color-text-muted)]">Credit/Debit cards, PayPal, and Crypto (USDT/USDC). All payments secured by Polar.sh.</p>
    </div>
    
    <div class="p-6 rounded-xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)]">
      <h3 class="font-semibold mb-2 text-[var(--color-text-primary)]">Can I get a refund?</h3>
      <p class="text-sm text-[var(--color-text-muted)]">30-day money-back guarantee. No questions asked.</p>
    </div>
  </div>
</section>

<!-- Guarantee -->
<section class="py-12 text-center">
  <div class="inline-block p-8 rounded-2xl bg-[var(--color-bg-tertiary)] border border-[var(--color-border)]">
    <div class="text-4xl mb-4">üõ°Ô∏è</div>
    <h3 class="text-xl font-semibold mb-2 text-[var(--color-text-primary)]">30-Day Money-Back Guarantee</h3>
    <p class="text-[var(--color-text-muted)]">Not satisfied? Get a full refund within 30 days. No questions asked.</p>
  </div>
</section>

<!-- Final CTA -->
<section class="py-12 text-center">
  <h2 class="text-2xl font-bold mb-4 text-[var(--color-text-primary)]">Ready to automate your agency?</h2>
  <div class="flex gap-4 justify-center">
    <a href="/docs/getting-started/installation" class="px-8 py-3 bg-[var(--color-accent-green)] text-white rounded-lg font-medium hover:brightness-110 transition-all">
      Start Free Trial
    </a>
    <a href="mailto:hello@agencyos.network" class="px-8 py-3 border border-[var(--color-accent-green)] text-[var(--color-accent-green)] rounded-lg font-medium hover:bg-[var(--color-accent-green)]/10 transition-all">
      Book a Demo
    </a>
  </div>
</section>

<script>
  // Promo code validation
  const promoInput = document.getElementById('promo-input') as HTMLInputElement;
  const applyBtn = document.getElementById('apply-promo-btn');
  const promoResult = document.getElementById('promo-result');
  const promoMessage = document.getElementById('promo-message');
  const promoBox = document.getElementById('promo-box');

  // Original prices
  const prices = {
    starter: 29,
    pro: 99,
    franchise: 299
  };

  applyBtn?.addEventListener('click', () => {
    const code = promoInput?.value.trim().toUpperCase();
    
    if (!code) {
      showError('Please enter a promo code');
      return;
    }

    // Check localStorage for generated codes
    const storedCampaign = localStorage.getItem('agencyos_promo_codes');
    let discount = 0;
    let isValid = false;

    if (storedCampaign) {
      const campaign = JSON.parse(storedCampaign);
      if (campaign.codes && campaign.codes.includes(code)) {
        discount = campaign.discount;
        isValid = true;
      }
    }

    // Check for LAUNCH100 pattern (first 100 free)
    // AGENCYOS-XXXX-XXXX = 8+1+4+1+4 = 18 characters
    if (code.startsWith('AGENCYOS-') && code.length === 18) {
      // Check if it looks like a valid generated code
      const validPattern = /^AGENCYOS-[A-Z0-9]{4}-[A-Z0-9]{4}$/;
      if (validPattern.test(code)) {
        discount = 100; // First 100 get 100% off
        isValid = true;
      }
    }

    if (isValid) {
      showSuccess(discount);
      updatePrices(discount);
      // Save applied code
      localStorage.setItem('agencyos_applied_code', JSON.stringify({ code, discount }));
    } else {
      showError('Invalid promo code');
    }
  });

  function showSuccess(discount: number) {
    if (promoResult && promoMessage && promoBox) {
      promoResult.classList.remove('hidden');
      promoMessage.classList.remove('text-red-500');
      promoMessage.classList.add('text-green-500');
      
      if (discount === 100) {
        promoMessage.textContent = `üéâ FREE ACCESS! 100% discount applied!`;
        promoBox.classList.add('border-green-500');
      } else {
        promoMessage.textContent = `${discount}% discount applied!`;
        promoBox.classList.add('border-green-500');
      }
    }
  }

  function showError(message: string) {
    if (promoResult && promoMessage && promoBox) {
      promoResult.classList.remove('hidden');
      promoMessage.classList.remove('text-green-500');
      promoMessage.classList.add('text-red-500');
      promoMessage.textContent = message;
      promoBox.classList.remove('border-green-500');
    }
  }

  function updatePrices(discount: number) {
    // Update displayed prices
    const priceElements = document.querySelectorAll('[data-price]');
    priceElements.forEach(el => {
      const originalPrice = parseInt(el.getAttribute('data-price') || '0');
      const newPrice = Math.round(originalPrice * (1 - discount / 100));
      
      if (discount === 100) {
        el.innerHTML = `<span class="line-through text-red-500">$${originalPrice}</span> <span class="text-green-500">FREE</span>`;
      } else if (discount > 0) {
        el.innerHTML = `<span class="line-through text-[var(--color-text-muted)]">$${originalPrice}</span> $${newPrice}`;
      }
    });

    // Add discount badge to pricing cards
    if (discount > 0) {
      const pricingCards = document.querySelectorAll('#pricing-plans > div > div');
      pricingCards.forEach(card => {
        if (!card.querySelector('.discount-badge')) {
          const badge = document.createElement('div');
          badge.className = 'discount-badge absolute -top-3 -right-3 px-3 py-1 bg-red-500 text-white text-xs font-bold rounded-full';
          badge.textContent = discount === 100 ? 'FREE!' : `-${discount}%`;
          (card as HTMLElement).style.position = 'relative';
          card.appendChild(badge);
        }
      });
    }
  }

  // Check for previously applied code
  const appliedCode = localStorage.getItem('agencyos_applied_code');
  if (appliedCode) {
    const { code, discount } = JSON.parse(appliedCode);
    if (promoInput) promoInput.value = code;
    showSuccess(discount);
    updatePrices(discount);
  }
</script>

</LandingLayout>
